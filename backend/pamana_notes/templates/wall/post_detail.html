{% extends "base.html" %}
{% block title %}View Post{% endblock %}

{% block content %}
<div class="container mt-4">

    <!-- Post -->
    <div class="card p-3 mb-4">
        <p>
            <strong>{{ post.user.school_id }}</strong>
            • {{ post.created_at|date:"M d, Y H:i" }}
        </p>
        <p>{{ post.content }}</p>
    </div>

    <!-- Add comment -->
    <div class="card p-3 mb-4">
        <h5>Add a comment</h5>
        <form method="POST" action="{% url 'wall:add_comment' post.id %}">
            {% csrf_token %}
            {{ comment_form.content }}
            <button class="btn btn-primary btn-sm mt-2">
                Comment
            </button>
        </form>
    </div>

    <!-- Comments -->
<h5>Comments</h5>

{% for comment in comments %}
    <div class="card p-2 mb-2">
        <p>
            <strong>{{ comment.user.school_id }}</strong>
            • {{ comment.created_at|date:"M d, Y H:i" }}
        </p>
        <p>{{ comment.content }}</p>

        <a href="{% url 'wall:comment_thread' comment.id %}"
           class="btn btn-sm btn-outline-primary">
            {% if comment.replies.count %}
                View replies ({{ comment.replies.count }})
            {% else %}
                Reply
            {% endif %}
        </a>
    </div>
{% empty %}
    <p class="text-muted">No comments yet.</p>
{% endfor %}

</div>
<!-- Modal JS (Rate Note style) -->
<script>
document.addEventListener("click", function (e) {
    const btn = e.target.closest(".view-replies-btn");
    if (!btn) return;

    const commentId = btn.dataset.commentId;

    fetch(`/wall/comment/${commentId}/replies/`)
        .then(response => response.json())
        .then(data => {
            document.getElementById("repliesModalBody").innerHTML = data.html;
            const modal = new bootstrap.Modal(
                document.getElementById("repliesModal")
            );
            modal.show();
        })
        .catch(err => {
            console.error("Failed to load replies:", err);
        });
});
</script>

{% endblock %}
